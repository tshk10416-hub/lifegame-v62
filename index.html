<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ライフリッジゲーム ~Life & Marriage~</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="titleScreen" class="title-screen">
        <h1>ライフリッジ<br>ゲーム</h1>
        <p class="subtitle">～Life & Marriage～ </p>
        <button onclick="startTitleGame()" class="start-btn">スタート</button>
        <button onclick="showHallOfFame()" class="start-btn btn-secondary" style="margin-top: 10px;">セーブデータ</button>
    </div>

    <div class="container" style="display: none;">
        
        <div class="player-section">
            <div class="player-card" id="player1">
                <h2><i class="fas fa-user"></i> <span class="player-name">プレイヤー1</span></h2>
                <div class="player-info">
                    <p>職業: <span id="p1-job">-</span></p>
                    <p>手取り年収: <span id="p1-income">0</span>万円</p>
                </div>
            </div>
            <div class="player-card" id="player2">
                <h2><i class="fas fa-user"></i> <span class="player-name">プレイヤー2</span></h2>
                <div class="player-info">
                    <p>職業: <span id="p2-job">-</span></p>
                    <p>手取り年収: <span id="p2-income">0</span>万円</p>
                </div>
            </div>
        </div>

        <div class="game-status">
            <div class="status-card">
                <h3><i class="fas fa-calendar-alt"></i> 現在の年代</h3>
                <p class="age-display" id="current-age">30代</p>
            </div>
            <div class="status-card">
                <h3><i class="fas fa-yen-sign"></i> 世帯手取り年収</h3>
                <p><span id="household-income">0</span>万円</p>
            </div>
            <div class="status-card">
                <h3><i class="fas fa-piggy-bank"></i> 総資産</h3>
                <p><span id="total-assets">0</span>万円</p>
            </div>
            <div class="status-card">
                <h3><i class="fas fa-wallet"></i> 年間支出</h3>
                <p><span id="annual-expense">0</span>万円</p>
            </div>
        </div>

        <div class="qr-section">
            <h3><i class="fas fa-qrcode"></i></h3>
            <div class="qr-buttons">
                 <button onclick="openMainScanButton()" class="btn-primary" style="width: 100%; color: #333;">
                    <i class="fas fa-qrcode"></i> カードを読み取る
                 </button>
            </div>
        </div>

        <div class="life-plan-details">
            <h3>📊 ライフプラン詳細</h3>
            <div class="detail-grid">
                <div class="detail-section">
                    <h4><i class="fas fa-heart"></i> 結婚</h4>
                    <p>タイプ: <span id="marriage-type">-</span></p>
                    <p>費用: <span id="marriage-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-child"></i> 子ども</h4>
                    <p>人数: <span id="children-count">0</span>人</p>
                    <p>年間費用: <span id="children-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-home"></i> 住宅</h4>
                    <p>タイプ: <span id="house-type">-</span></p>
                    <p>年間費用: <span id="house-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-car-side"></i> 自動車</h4>
                    <p>タイプ: <span id="car-type">-</span></p>
                    <p>台数: <span id="car-count">0</span>台</p>
                    <p>費用 (累計): <span id="car-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-shield-alt"></i> 保険</h4>
                    <p>生命保険: <span id="life-insurance">未加入</span></p>
                    <p>火災保険: <span id="fire-insurance">未加入</span></p>
                    <p>自動車保険: <span id="auto-insurance">未加入</span></p>
                    <p>年間保険料: <span id="insurance-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-shopping-cart"></i> 生活費</h4>
                    <p>年間: <span id="living-cost">0</span>万円</p>
                </div>
                <div class="detail-section">
                    <h4><i class="fas fa-chart-line"></i> 投資</h4>
                    <p>積立投資(年): <span id="tsumitate-amount">0</span>万円</p>
                    <p>一括投資: <span id="ikkatsu-amount">0</span>万円</p>
                </div>
            </div>
        </div>

        <div class="event-log">
            <h3>📝 イベントログ</h3>
            <div id="event-list"></div>
        </div>

        <div class="control-buttons" style="grid-template-columns: 1fr;">
            <button onclick="nextTurn()" class="btn-primary">
                <i class="fas fa-arrow-right"></i> 次のターンへ
            </button>
            <button onclick="showBalance()" class="btn-secondary">
                <i class="fas fa-table"></i> 収支詳細を見る
            </button>
            <button onclick="window.location.href='graph.html'" class="btn-secondary">
                <i class="fas fa-chart-line"></i> 収支グラフを見る
            </button>
            <button onclick="resetGame()" class="btn-danger">
                <i class="fas fa-redo"></i> ゲームリセット
            </button>
        </div>
    </div>

    <div id="setupModal" class="modal">
        <div class="modal-content">
            <h2>プレイヤー名を入力してください</h2>
            <div class="player-setup">
                <div class="input-group">
                    <label>プレイヤー1の名前</label>
                    <input type="text" id="player1Name" placeholder="名前を入力">
                </div>
                <div class="input-group">
                    <label>プレイヤー2の名前</label>
                    <input type="text" id="player2Name" placeholder="名前を入力">
                </div>
                <button onclick="startGame()" class="start-btn">ゲームスタート！</button>
            </div>
        </div>
    </div>

    <div id="cameraModal" class="modal">
        <div class="modal-content camera-modal-content">
            <h2>🃏 カードをスキャンしてください</h2>
            <div class="camera-view">
                <video id="cameraVideo" playsinline autoplay></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
                <p id="scanStatus" class="scan-status">カメラを起動中...</p>
            </div>
            <button onclick="stopScan()" class="btn-danger">
                <i class="fas fa-times"></i> スキャンを中止
            </button>
        </div>
    </div>

    <div id="cardInfoModal" class="modal">
        <div class="modal-content card-info-content">
            <div id="card-info-header" class="card-header">
                <h2 id="card-info-title"></h2>
                <p id="card-info-id"></p>
            </div>
            <div class="card-effect">
                <p>効果:</p>
                <p id="card-info-effect"></p>
            </div>
            <div class="modal-buttons">
                 <button onclick="applyCardEffect()" class="btn-success"><i class="fas fa-check"></i> このカードを適用する</button>
                 <button onclick="showExplanation()" class="btn-secondary"><i class="fas fa-info-circle"></i> 解説を見る</button>
                 <button onclick="closeCardInfoModal()" class="btn-secondary"><i class="fas fa-times"></i> キャンセル</button>
            </div>
        </div>
    </div>

    <div id="netIncomeModal" class="modal">
        <div class="modal-content card-info-content">
            <h2 id="net-income-player-name" style="color: #48bb78;"></h2>
            <div class="card-effect" style="border-color: #A8E063;">
                <p>額面年収:</p>
                <p id="net-income-gross" style="font-size: 1.2em; color: #555;"></p>
            </div>
            <div class="card-effect" style="border-color: #48bb78;">
                <p>手取り年収 (目安):</p>
                <p id="net-income-net" style="font-size: 1.5em; color: #48bb78;"></p>
            </div>
            <div class="modal-buttons" style="grid-template-columns: 1fr 1fr;">
                 <button onclick="showDeductionDetailsModal()" class="btn-secondary"><i class="fas fa-info-circle"></i> 控除内訳 (解説)</button>
                 <button onclick="closeNetIncomeModal()" class="btn-success"><i class="fas fa-check"></i> OK</button>
            </div>
        </div>
    </div>

    <div id="deductionDetailsModal" class="modal">
        <div class="modal-content">
            <h2>控除内訳 (ゲーム用概算)</h2>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                額面年収から引かれる税金・社会保険料の目安です。
            </p>
            <table class="balance-table">
                <thead>
                    <tr><th>項目</th><th>年間控除額 (目安)</th></tr>
                </thead>
                <tbody>
                    <tr><td><i class="fas fa-clinic-medical expense-icon"></i> 健康保険料</td><td id="deduction-health">0万円</td></tr>
                    <tr><td><i class="fas fa-building expense-icon"></i> 厚生年金保険料</td><td id="deduction-pension">0万円</td></tr>
                    <tr><td><i class="fas fa-briefcase expense-icon"></i> 雇用保険料</td><td id="deduction-employment">0万円</td></tr>
                    <tr><td><i class="fas fa-file-invoice-dollar expense-icon"></i> 所得税</td><td id="deduction-income-tax">0万円</td></tr>
                    <tr><td><i class="fas fa-city expense-icon"></i> 住民税</td><td id="deduction-resident-tax">0万円</td></tr>
                </tbody>
                <tfoot>
                    <tr style="font-weight: bold; border-top: 2px solid #ccc;">
                        <td>控除合計</td>
                        <td id="deduction-total">0万円</td>
                    </tr>
                </tfoot>
            </table>
            <button onclick="closeDeductionDetailsModal()" class="btn-primary" style="margin-top: 20px;">閉じる</button>
        </div>
    </div>


    <div id="explanationModal" class="modal">
        <div class="modal-content">
            <h2>カード解説</h2>
            <p id="card-explanation"></p>
            <button onclick="closeExplanationModal()" class="btn-primary">閉じる</button>
        </div>
    </div>

    <div id="turnStartModal" class="modal">
        <div class="modal-content" style="text-align: center;">
             <h2 id="turn-start-title" style="color: #FF7F50; font-size: 2em; margin-bottom: 20px;"></h2>
             <p id="turn-start-text" style="margin-bottom: 30px; font-size: 1.2em;">新しいターンを開始します。</p>
             <button id="turn-start-button" onclick="proceedToTurnActions()" class="btn-success" style="width: 100%;"><i class="fas fa-play"></i> ターン開始</button>
        </div>
    </div>

    <div id="guidanceModal" class="modal">
        <div class="modal-content" style="text-align: center;">
             <h2 id="guidance-title"></h2>
             <p id="guidance-text" style="margin-bottom: 20px;"></p>
             <button id="guidance-ok-button" class="btn-primary"><i class="fas fa-qrcode"></i> スキャンする</button>
             <button id="guidance-done-button" class="btn-success" style="display: none; margin-top: 10px;"><i class="fas fa-check-double"></i> 完了して次へ</button>
             <button id="guidance-skip-button" class="btn-secondary" style="margin-top: 10px;"><i class="fas fa-times"></i> スキップ</button>
        </div>
    </div>

    <div id="ageGuidanceModal" class="modal">
        <div class="modal-content" style="text-align: center;">
             <h2 id="age-guidance-title" style="color: #FF7F50; font-size: 1.8em; margin-bottom: 20px;"></h2>
             
             <div id="age-guidance-text" style="text-align: left; margin-bottom: 25px; line-height: 1.7; font-size: 0.95em;">
                </div>
             
             <button onclick="closeAgeGuidanceModal()" class="btn-success" style="width: 100%;"><i class="fas fa-check"></i> 確認して次へ</button>
        </div>
    </div>
    
    <div id="balanceModal" class="modal">
        <div class="modal-content">
            <h2 id="balance-modal-title">収支詳細 (直近10年)</h2>
            <table class="balance-table" id="turnBreakdownTable">
                <thead>
                    <tr>
                        <th>項目</th>
                        <th>10年間の合計額 (万円)</th>
                    </tr>
                </thead>
                <tbody id="turnBreakdownTbody">
                </tbody>
            </table>
            <p style="font-size: 0.9em; color: #666; margin-top: 15px;">
                ※結婚費用、自動車購入費、イベント費用、一括投資などの一時的な収支は「差額」に含まれます。
            </p>
            <button onclick="closeBalanceModal()" class="btn-primary" style="margin-top: 20px;">閉じる</button>
        </div>
    </div>

    <div id="careerChallengeModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-briefcase"></i> キャリアチャレンジ</h2>
            <p style="margin-bottom: 20px; font-weight: bold; font-size: 1.2em;">
                <span id="career-challenge-player-name"></span> さんの番です
            </p>
            <p>年代が上がりました。行動を選択してください。</p>
            <div class="modal-buttons" style="grid-template-columns: 1fr; margin-top: 20px;">
                 <button onclick="handleCareerChoice('jobChange')" class="btn-primary"><i class="fas fa-random"></i> 転職チャレンジ (1, 6で成功)</button>
                 <button onclick="handleCareerChoice('promotion')" class="btn-success"><i class="fas fa-arrow-up"></i> 昇格チャレンジ (3, 5で成功)</button>
                 <button onclick="handleCareerChoice('skip')" class="btn-secondary"><i class="fas fa-user-check"></i> 現状維持 (自動昇給)</button>
            </div>
        </div>
    </div>

    <div id="finalResultModal" class="modal">
        <div class="final-result-content">
            <h2><i class="fas fa-trophy"></i> 60代 セカンドライフ到達！</h2>
            
            <div id="lifeplanSummary" style="min-height: 50px;">
                 <p style="font-size: 1.2em; margin-bottom: 20px;">お疲れ様でした！<br>最終ゲーム結果を確認してください。</p>
            </div>
            
            <button onclick="showInvestmentRateModal()" class="btn-primary" style="margin-top: 20px;">
                <i class="fas fa-chart-pie"></i> ゲーム結果を見る
            </button>
        </div>
    </div>
    
    <div id="investmentRateModal" class="modal">
        <div class="modal-content" style="text-align: center;">
             <h2 style="color: #FF7F50; font-size: 1.8em; margin-bottom: 20px;">
                <i class="fas fa-dice"></i> 投資利率の決定
             </h2>
             <p style="margin-bottom: 20px; font-size: 1.1em;">
                65歳になりました！<br>
                これまでの投資成果を決定します。
             </p>
             <p style="margin-bottom: 25px;">
                サイコロを1回振って、運用年利（％）を決定してください。
             </p>
             
             <div class="input-group">
                <label for="diceRollInput" style="font-weight: bold; font-size: 1.1em;">サイコロの出目 (1〜6)</label>
                <input type="number" id="diceRollInput" min="1" max="6" style="text-align: center; font-size: 1.5em; padding: 10px; max-width: 150px; margin: 10px auto 0 auto;">
             </div>
             
             <button onclick="calculateInvestmentResult()" class="btn-success" style="width: 100%; margin-top: 20px;">
                <i class="fas fa-calculator"></i> 運用結果を計算する
             </button>
        </div>
    </div>

    <div id="investmentResultModal" class="modal">
        <div class="modal-content-large"> 
            <h2><i class="fas fa-chart-line"></i> 投資運用結果</h2>
            
            <div id="investmentResultSummary">
                </div>
            
            <button onclick="showFinalAssets()" class="btn-success" style="width: 100%; margin-top: 20px;">
                <i class="fas fa-trophy"></i> 最終ライフプラン結果を見る
            </button>
            <button onclick="closeInvestmentResultModal()" class="btn-secondary" style="width: 100%; margin-top: 10px;">
                閉じる
            </button>
        </div>
    </div>

    <div id="finalAssetsModal" class="modal">
        <div class="modal-content-xlarge"> 
            <h2><i class="fas fa-chart-pie"></i> 最終ライフプラン結果</h2>
            
            <div id="finalAssetsSummary">
                </div>
            
            <div class="modal-buttons" style="margin-top: 30px;">
                 <button onclick="showFinalBalanceDetails()" class="btn-secondary"><i class="fas fa-table"></i> 収支を見る</button>
                 <button onclick="showFinalGraph()" class="btn-secondary"><i class="fas fa-chart-line"></i> グラフを見る</button>
            </div>
            
            <button onclick="saveAndExitGame()" class="btn-primary" style="margin-top: 20px;">
                <i class="fas fa-save"></i> ゲームを終了してタイトルへ
            </button>
        </div>
    </div>

    <div id="finalBalanceModal" class="modal">
        <div class="modal-content-xlarge"> 
            <h2><i class="fas fa-table"></i> 年代別 収支詳細</h2>
            <div id="finalBalanceDetailsContainer" style="max-height: 400px; overflow-y: auto; padding: 5px;">
                </div>
            <button onclick="closeFinalBalanceModal()" class="btn-primary" style="margin-top: 20px;">閉じる</button>
        </div>
    </div>

    <div id="finalGraphModal" class="modal">
        <div class="modal-content-xlarge"> 
            <h2><i class="fas fa-chart-line"></i> 最終資産グラフ (65歳時点)</h2>
            <div class="chart-container-modal">
                <canvas id="finalBalanceChart"></canvas>
            </div>
            <button onclick="closeFinalGraphModal()" class="btn-primary" style="margin-top: 20px;">閉じる</button>
        </div>
    </div>
    
    <div id="hallOfFameModal" class="modal">
        <div class="modal-content-xlarge"> 
            <h2><i class="fas fa-trophy"></i> セーブデータ (殿堂入り)</h2>
            <div id="hallOfFameContainer" style="max-height: 450px; overflow-y: auto; padding: 5px;">
                </div>
            <button onclick="closeHallOfFameModal()" class="btn-primary" style="margin-top: 20px;">閉じる</button>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="game.js"></script>
</body>
</html>